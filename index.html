<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panopto Caption Extractor - Working Solution</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen p-8">
    <div class="max-w-4xl mx-auto">
        <div class="text-center mb-12">
            <h1 class="text-6xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-4">
                🎯 Panopto Caption Extractor
            </h1>
            <p class="text-2xl text-slate-700">Extract captions in 30 seconds</p>
        </div>

        <div class="bg-white rounded-2xl shadow-2xl p-10 mb-8">
            <h2 class="text-3xl font-bold text-blue-700 mb-8">✨ 3 Simple Steps</h2>
            
            <div class="space-y-6">
                <div class="bg-blue-50 border-l-4 border-blue-600 p-6 rounded-r-xl">
                    <h3 class="text-2xl font-bold text-blue-800 mb-4">Step 1: Copy The Script</h3>
                    <button onclick="copyScript()" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-4 rounded-xl font-bold text-lg transition-all transform hover:scale-105">
                        📋 Click to Copy Script
                    </button>
                    <p id="copied" class="text-green-600 font-bold mt-3 hidden">✅ Copied! Go to step 2</p>
                </div>

                <div class="bg-green-50 border-l-4 border-green-600 p-6 rounded-r-xl">
                    <h3 class="text-2xl font-bold text-green-800 mb-4">Step 2: Open Panopto Video</h3>
                    <p class="text-green-700 mb-4 text-lg">Go to your Panopto video and sign in</p>
                    <a href="https://qub.cloud.panopto.eu/" target="_blank" class="inline-block bg-green-600 hover:bg-green-700 text-white px-8 py-4 rounded-xl font-bold text-lg transition-all transform hover:scale-105">
                        🌐 Open QUB Panopto
                    </a>
                </div>

                <div class="bg-purple-50 border-l-4 border-purple-600 p-6 rounded-r-xl">
                    <h3 class="text-2xl font-bold text-purple-800 mb-4">Step 3: Run The Script</h3>
                    <div class="text-purple-700 space-y-3 text-lg">
                        <p>1. On the Panopto page, press <kbd class="bg-purple-200 px-3 py-1 rounded font-mono">F12</kbd></p>
                        <p>2. Click the <strong>Console</strong> tab</p>
                        <p>3. Paste the script (Ctrl+V)</p>
                        <p>4. Press <kbd class="bg-purple-200 px-3 py-1 rounded font-mono">Enter</kbd></p>
                        <p class="text-purple-900 font-bold text-xl mt-4">🎉 Captions appear in a popup!</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-2xl p-10">
            <h2 class="text-2xl font-bold text-slate-800 mb-4">📜 The Script (Click "Copy" above)</h2>
            <div class="bg-slate-900 text-green-400 p-6 rounded-xl overflow-x-auto max-h-96 overflow-y-auto">
                <pre id="script" class="text-sm">(function(){console.log('%c🔍 Panopto Extraction Started','color:#3b82f6;font-size:16px;font-weight:bold');let captions=[],slides=[],metadata={};try{if(window.PanoptoViewer&&window.PanoptoViewer.deliveryInfo){const info=window.PanoptoViewer.deliveryInfo;console.log('%c✅ Found Panopto data','color:#10b981');if(info.CaptionSegments&&Array.isArray(info.CaptionSegments)){captions=info.CaptionSegments.map(seg=>({start:seg.StartTime||0,end:seg.EndTime||0,text:seg.Text||''}));console.log('%c✅ Found '+captions.length+' captions','color:#10b981')}if(info.TableOfContents&&Array.isArray(info.TableOfContents)){slides=info.TableOfContents.map(slide=>({time:slide.Time||0,title:slide.Title||'',imageUrl:slide.ImageUrl||''}));console.log('%c✅ Found '+slides.length+' slides','color:#10b981')}metadata={title:info.Title||'Panopto Video',description:info.Description||'',duration:info.Duration||0,creator:info.Creator||'',created:info.CreatedDate||'',sessionId:info.SessionID||''}}else{throw new Error('Not on a Panopto video page')}const transcript=captions.map(c=>c.text).join(' ');if(!transcript.length)throw new Error('No captions found');console.log('%c📊 Extraction complete!','color:#10b981;font-size:16px;font-weight:bold');const popup=window.open('','results','width=900,height=700,scrollbars=yes');popup.document.write(`<!DOCTYPE html><html><head><title>Panopto Results</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:system-ui;background:linear-gradient(135deg,#667eea,#764ba2);padding:20px;min-height:100vh}.container{max-width:800px;margin:0 auto;background:white;border-radius:20px;padding:40px;box-shadow:0 20px 60px rgba(0,0,0,0.3)}h1{color:#1e293b;font-size:32px;margin-bottom:20px}.stats{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin:20px 0}.stat{background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:20px;border-radius:10px;text-align:center}.stat-number{font-size:32px;font-weight:bold;display:block}.stat-label{font-size:14px;opacity:0.9;margin-top:5px}h2{color:#475569;font-size:20px;margin:30px 0 15px;padding-bottom:10px;border-bottom:2px solid #e2e8f0}textarea{width:100%;height:300px;padding:15px;border:2px solid #e2e8f0;border-radius:10px;font-family:monospace;font-size:13px;resize:vertical;margin-bottom:15px}.button{background:linear-gradient(135deg,#667eea,#764ba2);color:white;border:none;padding:12px 24px;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;margin-right:10px;transition:transform 0.2s}.button:hover{transform:translateY(-2px)}.success{background:#10b981;color:white;padding:10px 20px;border-radius:8px;margin-top:10px;display:none}</style></head><body><div class="container"><h1>✅ Extraction Successful!</h1><div class="stats"><div class="stat"><span class="stat-number">${captions.length}</span><span class="stat-label">Captions</span></div><div class="stat"><span class="stat-number">${slides.length}</span><span class="stat-label">Slides</span></div><div class="stat"><span class="stat-number">${Math.floor(metadata.duration/60)}m</span><span class="stat-label">Duration</span></div></div><h2>📹 Video Info</h2><p style="color:#1e293b;font-size:16px;line-height:1.6"><strong>Title:</strong> ${metadata.title}<br><strong>Creator:</strong> ${metadata.creator}<br><strong>ID:</strong> ${metadata.sessionId}</p><h2>📝 Transcript</h2><textarea id="transcript" readonly>${transcript}</textarea><button class="button" onclick="navigator.clipboard.writeText('${transcript.replace(/'/g,"\\'")}').then(()=>{document.getElementById('success').style.display='block';setTimeout(()=>document.getElementById('success').style.display='none',2000)})">📋 Copy</button><button class="button" onclick="const blob=new Blob(['${transcript.replace(/'/g,"\\'")}'],{type:'text/plain'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='panopto-${metadata.sessionId}.txt';a.click()">💾 Download</button><div id="success" class="success">✅ Copied!</div></div></body></html>`)}catch(error){console.error('%c❌ Failed:','color:#ef4444;font-size:16px;font-weight:bold',error);alert('❌ Extraction failed: '+error.message+'\n\nMake sure:\n1. You are on a Panopto video page\n2. You are signed in\n3. The video has captions')}})();</pre>
            </div>
        </div>
    </div>

    <script>
        function copyScript() {
            const script = document.getElementById('script').textContent;
            navigator.clipboard.writeText(script).then(() => {
                document.getElementById('copied').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('copied').classList.add('hidden');
                }, 5000);
            }).catch(() => {
                alert('Failed to copy. Please select and copy the script manually.');
            });
        }
    </script>
</body>
</html>
